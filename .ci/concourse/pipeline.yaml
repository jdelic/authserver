resource_types:
    - name: bitbucket-notify
      type: docker-image
      source:
          repository: ecometrica/concourse-resource-bitbucket


resources:
    - name: authserver
      type: git
      source:
          uri: git@bitbucket.org:jdelic/authserver.git
          private_key: {{bitbucket_access_key}}
          branch: feature/concourse

    - name: bitbucket-notify
      type: bitbucket-notify
      source:
          client_id: {{bitbucket_client_id}}
          secret: {{bitbucket_client_secret}}
          repo: jdelic/authserver


jobs:
    - name: authserver-tests
      plan:
          - get: authserver
            trigger: true
          - put: bitbucket-notify
            params:
                state: INPROGRESS
                repo: authserver
          - task: run-mypy
            file: authserver/.ci/concourse/mypy.yaml
            on_failure:
                put: bitbucket-notify
                params:
                    state: FAILED
                    repo: authserver
            on_success:
                put: bitbucket-notify
                params:
                    state: SUCCESSFUL
                    repo: authserver
